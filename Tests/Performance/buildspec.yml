version: 0.2

phases:
  install:
    commands:
      - echo Entered the install phase...
      #- yum -y install curl
      - yum remove nodejs
      - curl -sL https://rpm.nodesource.com/setup_14.x | bash
      - yum install -y nodejs
      - node --version
      - mkdir artillery
      - cd artillery
      - npm install -g artillery@latest
      - npm init
      - artillery dino
    finally:
      - echo This always runs even if the update or install command fails 
  pre_build:
    commands:
      - echo Entered the pre_build phase...
      - cd ../Tests/Performance
      - mkdir results
    finally:
      - echo This always runs even if the login command fails 
  build:
    commands:
      - echo Entered the build phase..
      - artillery run --target $SITE_URL --output results/report.json tests/perf-test.yaml
      - artillery report --output results/perf-test.html results/report.json
    finally:
      - echo This always runs even if the install command fails
  post_build:
    commands:
      - echo Entered the post_build phase...
      - echo Build completed on `date`
#reports:
  #regression-suite:
  #  files:
  #    - 'Tests/tests/results.xml'
  #  file-format: JUNITXML
artifacts:
  files:
    - "**/*"